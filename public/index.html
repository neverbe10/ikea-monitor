<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-167400132-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-167400132-1');
    </script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <style>
      span.status.Open {
        color: #28a745;
      }
      span.status.Closed {
        color: #ffc107;
      }
      span.status.Unknown {
        color: rgba(0,0,0,.5);
      }
      sup small {
        font-size: 0.8rem;
      }
      .subscribe-checkbox {
        border-width: 0.5px;
      }
      .subscribe-checkbox:checked {
        background-color: white;
      }
      .location-name {
        margin-left: 4px;
      }
      #subscribe-email-address {
        text-align: center;
      }
      #story h5 {
        text-align: center;
      }
      #story p {
        text-indent: 2em;
      }
    </style>

    <title>IKEA Click & Collect Availability</title>
    <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="dongst" data-description="Support me, please!" data-message="Thank you for visiting. You can now buy me a coffee!" data-color="#FF813F" data-position="right" data-x_margin="18" data-y_margin="18"></script>
  </head>
  <body>
    <nav class="navbar bg-light">
      <span class="navbar-text m-auto text-center">
        <a target="_blank" href="https://cdn.forms-content.sg-form.com/309c87b8-9ee9-11ea-9bc4-1adbad87d676">Get updates</a> when new features such as text message notification, availability history and auto page refresh are ready. <a target="_blank" href="https://www.reddit.com/r/IKEA/comments/gpl3x0/ikea_click_collect_status_website/">Feedback</a><hr><mark>May 27, 2020: <a href="#subscribe-container">Email Notification<sup>beta</sup></a>!</mark>
      </span>
    </nav>
    <div class="container text-center mt-5 px-4">
      <h1 class="d-inline-block">IKEA Click & Collect<sup style="top: -0.7em;"><small><a tabindex="0" class="text-secondary" data-container="body"  data-placement="top" data-toggle="popover" data-trigger="sfocus" data-content="Click & Collect is the online order + curbside pick-up service provided by IKEA.">ⓘ</a></small></sup><wbr>Availability</h1>
      <p class="mt-4">updated every minute.</p>
    </div>
    <div class="container mt-5 mb-5">
      <div class="sharethis-inline-share-buttons"></div>
    </div>
    <div class="container mt-5 mb-3 text-center legend">
      <span class="badge badge-light"><span class="status Open">●</span> Open for new order</span><br>
      <span class="badge badge-light"><span class="status Closed">●</span> Closed for new order</span><br>
      <span class="badge badge-light"><span class="status Unknown">●</span> Unknown</span>
    </div>
    <div class="container px-5 mt-5 us-states">
      <hr>
      <h5 class="text-center pt-4 pb-3">United States</h5>
      <div class="row">
      </div>
      <p class="small text-center mt-4">More locations in the United States will appear as soon as Click & Collect service becomes operative. <a target="_blank" href="https://www.ikea.com/us/en/customer-service/faq/">Official updates.</a></p>
    </div>
    <div class="container px-5 mt-5 ca-states">
      <hr>
      <h5 class="text-center pt-4 pb-3">Canada</h5>
      <div class="row">
      </div>
      <p class="small text-center mt-4">More locations in Canada will appear as soon as Click & Collect service becomes operative. <a target="_blank" href="https://www.ikea.com/ca/en/customer-service/services/updates-to-our-services-pub05de56e0">Official updates.</a></p>
    </div>
    <div class="container px-5 mt-5 subscribe" id="subscribe-container">
      <hr>
      <h2 class="text-center pt-4 pb-3">Subscribe<sup><small>beta</small></sup></h2>
      <p class="text-center my-4">An email will be sent to you whenever locations open for new Click & Collect order. </p>
      <div class="row pt-4 justify-content-center text-center">
        <div>
          <input type="email" class="form-control" id="subscribe-email-address" placeholder="email address">
        </div>
      </div>
      <div class="row pt-1 pb-4 justify-content-center text-center" id="subscribe-to-be">
        <div class="col-8 col-sm-8 col-md-6 col-lg-4 col-xl-4">
          <p><small id="subscribe-count" class="form-text text-secondary">Check the boxes above to select locations before clicking "Subscribe".</small></p>
        </div>
      </div>
      <div class="row pt-1 pb-4 justify-content-center text-center d-none" id="subscription-confirmation">
        <div class="col-10 col-sm-10 col-md-10 col-lg-6 col-xl-6">
          <p><small class="form-text text-success">Congratulations!<br>You will receive an email confirming your subscription.</small></p>
          <p><small class="form-text text-secondary">Please check your spam folder, too. If you haven't received it in 10 minutes, you may need to check the spelling of your email address or try with another one.</small></p>
        </div>
      </div>
      <div class="row pt-4 justify-content-center">
        <button class="btn btn-primary" type="button" id="subscribe-button">Subscribe</button>
      </div>
      <div class="row pt-2 justify-content-center">
        <button type="button" class="btn btn-link" id="unsubscribe-all-button">Unsubscribe all</button>
      </div>
    </div>
    <div class="container my-4" id="sharethis">
      <div class="sharethis-inline-share-buttons"></div>
    </div>
    <div class="container mt-3 story" id="story">
      <div class="row justify-content-center ">
        <div style="background-color: #f5f3f0;" class="col-10 col-sm-10 col-md-8 col-lg-6 col-xl-6 border rounded p-4">
          <h5 class="p-2">The Story</h5>
          <p style="text-align: center;text-indent: 0;"><small>May 27, 2020</small></p>
          <p>
            After a week of trying to order a watering can for my patio herbs from IKEA, by the time I was going to give up, an idea crossed my mind—what about writing some code to get my order through? It was intimidating because I haven't been coding for years, besides the fact that I was just a self-taught developer in the first place. Luckily, my wife supported me, and I decided to do it.
          </p>
          <p>
            On the first day of coding, I spotted a slot and got my order placed, but I didn't want to stop. This is fun! And I want more! Why not make a website to help others like me? Surprisingly, the more I write, the easier it gets, as if the passion for creating beautiful apps has never left me.
          </p>
          <p>
            Three days ago, the first public version of the website went online. I posted a link on reddit in the hope of attracting ideally dozens of users. However, things went well beyond what I expected. So far, ten thousand people have visited my website, doubling every day. People from Canada asked for support. Developers offered free server and code contribution. And most importantly, people are finally getting the desk for their daughter, patio set for their birthday and crib for their baby. I feel so honored to be part of this.
          </p>
          <p>
            I'd like to continue my website free of charge without ads, develop text notification and other features in the future. Please support me! For you guys who already bought me coffees, thank you!
          </p>
          <div class="pt-4 pb-2 d-block mx-auto text-center">
            <style>.bmc-button img{height: 34px !important;width: 35px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{padding: 7px 15px 7px 10px !important;line-height: 35px !important;height:51px !important;text-decoration: none !important;display:inline-flex !important;color:#FFFFFF !important;background-color:#FF813F !important;border-radius: 5px !important;border: 1px solid transparent !important;padding: 7px 15px 7px 10px !important;font-size: 22px !important;letter-spacing: 0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#FFFFFF !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/dongst"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee"><span style="margin-left:5px;font-size:28px !important;">Buy me a coffee</span></a>
          </div>
          <div class="pt-3 pb-2">
            <div style="width:117px;" class="mx-auto gfm-embed" data-url="https://www.gofundme.com/f/ikea-click-amp-collect-availability-website/widget/small"></div><script defer src="https://www.gofundme.com/static/js/embed.js"></script>
          </div>
        </div>
      </div>
    </div>
    <div class="container p-5 mt-5 mb-5 text-center">
      <p class="small text-muted font-weight-light">This is not an IKEA website. IKEA® is a registered trademark of Inter-IKEA Systems B.V. in the U.S. and other countries.</p>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5ec9fe6535f3dd0012878f08&product=inline-share-buttons&cms=website' async='async'></script>
    <script type="text/javascript">
      $.get("latest.json", function (latest) {
        for (const store of latest) {
          let status = store.lastStatus ? store.lastStatus.charAt(0).toUpperCase() + store.lastStatus.slice(1) : 'Unknown';
          // if (new Date() - new Date(store.lastUpdated) > 300000) status = 'Unknown';
          console.log(status);
          if ($(`div.${store.state}`).length == 0) $(`div.${store.country}-states div.row`).append(`<div class="${store.state} col-12 col-sm-12 col-md-4 col-lg-4 col-xl-3 my-2 text-center"><p><h6>${store.state}</h6><ul class="list-unstyled"></ul></div>`);
          $(`div.${store.state} ul`).append(`<li><input type="checkbox" class="form-check-input subscribe-checkbox" id="${store.name}"><label class="form-check-label location-name" for="${store.name}">${store.name}&nbsp;&nbsp;<span class="status ${status}">●</span></label></li>`);
        }
        $('.subscribe-checkbox').change(function () {
            $(this).next().toggleClass('font-weight-bold');
            let locations = $('.subscribe-checkbox:checked').map(function () {return this.id});
            if (locations.length == 0) $('#subscribe-count').text('Check the boxes above to select locations before clicking "Subscribe".');
            else $('#subscribe-count').text(`You are about to subscribe to email notification for IKEA ${locations.get().join(', ')}.`);
        });
        $('#subscribe-button').click(function() {
          let email = $('#subscribe-email-address').val();
          let locations = $('.subscribe-checkbox:checked').map(function () {return this.id}).get();
          if (locations.length == 0) {
            window.alert('Check the boxes above to select locations before clicking "Subscribe".');
            return;
          }
          if (email.length == 0) {
            window.alert('Please input your email address.');
            return;
          }
          if (!document.getElementById("subscribe-email-address").validity.valid) {
            window.alert('Please double check your email address.');
            return;
          }
          $.post( "subscribe", { email: email, storeNames: locations },  function () {
            $('#subscribe-button').text('Subscribed');
            $('#subscribe-button').prop('disabled', true);
            $("#subscribe-to-be").addClass('d-none');
            $("#subscription-confirmation").removeClass('d-none');
            console.log('Successfully subscribed.');
          });
        });
        $('#unsubscribe-all-button').click(function() {
          let email = $('#subscribe-email-address').val();
          if (email.length == 0) {
            window.alert('Please input your email address.');
            return;
          }
          // if (!document.getElementById("subscribe-email-address").validity.valid) {
          //   window.alert('Please double check your email address.');
          //   return;
          // }
          $.post( "unsubscribe_all", { email: email },  function () {
            $('#unsubscribe-all-button').text('Unsubscribed');
            $('#unsubscribe-all-button').prop('disabled', true);
            console.log('Successfully unsubscribed all.');
          });
        });
        $('#subscribe-email-address').keypress(function(e) {
            if(e.which == 13) {
                $('#subscribe-button').click();
            }
        });
      });
      $('[data-toggle="popover"]').popover({
        trigger: 'focus'
      });
    </script>
  </body>
</html>
